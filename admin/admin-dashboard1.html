<!doctype html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Even Travel - Tableau de Bord Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link
        href="https://fonts.googleapis.com/css2?family=Italiana&family=Marko+One&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet" />

    <style>
        :root {
            --sand: #e8ddd0;
            --stone: #d4c4b0;
            --terracotta: #b8856a;
            --ochre: #c4916b;
            --bronze: #8b6f47;
            --deep-brown: #5c4a3a;
            --cream: #f5f1ea;
            --white: #ffffff;
            --text-dark: #2a2420;
            --text-muted: #6b5d52;
            --spacing-xs: 8px;
            --spacing-sm: 16px;
            --spacing-md: 32px;
            --spacing-lg: 64px;
            --spacing-xl: 96px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family:
                "Inter",
                system-ui,
                -apple-system,
                sans-serif;
            font-size: 16px;
            line-height: 1.7;
            background: var(--cream);
            color: var(--text-dark);
            -webkit-font-smoothing: antialiased;
            font-weight: 400;
        }

        h1,
        h2,
        h3,
        h4 {
            font-family: "Inter", sans-serif;
            font-weight: 600;
            line-height: 1.2;
            color: var(--deep-brown);
        }

        header {
            background: var(--white);
            padding: 0;
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
            }

            to {
                transform: translateY(0);
            }
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            height: 80px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-family: "Italiana", serif;
            font-size: 28px;
            color: var(--terracotta);
        }

        .admin-actions {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .admin-actions span {
            color: var(--text-muted);
            font-size: 15px;
            font-weight: 500;
        }

        .logout-btn {
            background: var(--terracotta);
            color: white;
            padding: 10px 24px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--bronze);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(184, 133, 106, 0.3);
        }

        .admin-container {
            display: flex;
            min-height: calc(100vh - 80px);
            max-width: 1600px;
            margin: 0 auto;
        }

        .sidebar {
            width: 280px;
            background: var(--white);
            padding: var(--spacing-md) 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 4px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 30px;
            color: var(--text-muted);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-size: 15px;
            font-weight: 500;
        }

        .sidebar-menu a i {
            font-size: 18px;
            width: 20px;
        }

        .sidebar-menu a:hover {
            background: var(--sand);
            color: var(--deep-brown);
        }

        .sidebar-menu a.active {
            background: linear-gradient(90deg, var(--sand), transparent);
            color: var(--deep-brown);
            border-left-color: var(--terracotta);
            font-weight: 600;
        }

        .main-content {
            flex: 1;
            padding: var(--spacing-lg) var(--spacing-md);
            background: var(--cream);
        }

        .dashboard-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .dashboard-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .section-title {
            font-size: 42px;
            font-weight: 600;
            color: var(--deep-brown);
        }

        .add-btn {
            background: var(--ochre);
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(196, 145, 107, 0.3);
        }

        .add-btn:hover {
            background: var(--bronze);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(196, 145, 107, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .stat-card {
            background: var(--white);
            padding: var(--spacing-md);
            border: 1px solid var(--stone);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg,
                    var(--terracotta),
                    var(--ochre));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-icon {
            font-size: 40px;
            color: var(--ochre);
            margin-bottom: var(--spacing-sm);
        }

        .stat-number {
            font-size: 48px;
            font-weight: 700;
            color: var(--deep-brown);
            margin-bottom: var(--spacing-xs);
            line-height: 1;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 15px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .data-table {
            background: var(--white);
            border: 1px solid var(--stone);
            overflow: hidden;
            margin-bottom: var(--spacing-lg);
        }

        .table-header {
            background: var(--sand);
            padding: 20px var(--spacing-md);
            border-bottom: 1px solid var(--stone);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--deep-brown);
        }

        .export-btn {
            background: transparent;
            color: var(--bronze);
            padding: 10px 24px;
            border: 2px solid var(--bronze);
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: var(--bronze);
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 18px var(--spacing-md);
            text-align: left;
            border-bottom: 1px solid var(--stone);
        }

        th {
            background: var(--cream);
            font-weight: 600;
            color: var(--deep-brown);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: var(--text-muted);
            font-size: 15px;
        }

        tbody tr {
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: var(--cream);
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            margin-right: 8px;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: var(--ochre);
            color: white;
        }

        .edit-btn:hover {
            background: var(--bronze);
            transform: translateY(-2px);
        }

        .delete-btn {
            background: transparent;
            color: var(--terracotta);
            border: 2px solid var(--terracotta);
        }

        .delete-btn:hover {
            background: var(--terracotta);
            color: white;
            transform: translateY(-2px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(42, 36, 32, 0.75);
            backdrop-filter: blur(4px);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--white);
            padding: var(--spacing-lg);
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
            border: 1px solid var(--stone);
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--sand);
        }

        .modal-title {
            font-size: 32px;
            font-weight: 600;
            color: var(--deep-brown);
        }

        .close-btn {
            background: var(--sand);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            color: var(--deep-brown);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: var(--terracotta);
            color: white;
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 600;
            color: var(--deep-brown);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid var(--stone);
            background: var(--cream);
            font-size: 15px;
            font-family: "Inter", sans-serif;
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--ochre);
            background: var(--white);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
            line-height: 1.6;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        .form-array {
            border: 1px solid var(--stone);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            background: var(--cream);
        }

        .array-item {
            background: var(--white);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            border: 1px solid var(--stone);
        }

        .array-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .remove-array-item {
            background: var(--terracotta);
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
        }

        .add-array-btn {
            background: var(--ochre);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: var(--spacing-sm);
            display: inline-block;
        }

        .form-section {
            background: var(--cream);
            padding: var(--spacing-md);
            border: 1px solid var(--stone);
            margin-bottom: var(--spacing-lg);
        }

        .section-title-small {
            font-size: 18px;
            color: var(--deep-brown);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 2px solid var(--ochre);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--sand);
        }

        .save-btn {
            background: var(--ochre);
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .save-btn:hover {
            background: var(--bronze);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(196, 145, 107, 0.3);
        }

        .cancel-modal-btn {
            background: transparent;
            color: var(--text-muted);
            padding: 14px 32px;
            border: 2px solid var(--stone);
            border-radius: 50px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .cancel-modal-btn:hover {
            border-color: var(--bronze);
            color: var(--bronze);
        }

        .status-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-active {
            background: rgba(184, 133, 106, 0.2);
            color: var(--terracotta);
        }

        .status-inactive {
            background: rgba(107, 93, 82, 0.2);
            color: var(--text-muted);
        }

        .status-published {
            background: rgba(196, 145, 107, 0.2);
            color: var(--ochre);
        }

        .status-draft {
            background: rgba(212, 196, 176, 0.3);
            color: var(--bronze);
        }

        .status-pending {
            background: rgba(139, 111, 71, 0.2);
            color: var(--bronze);
        }

        .status-approved {
            background: rgba(92, 74, 58, 0.2);
            color: var(--deep-brown);
        }

        .status-paid {
            background: rgba(196, 145, 107, 0.2);
            color: var(--ochre);
        }

        .status-cancelled {
            background: rgba(184, 133, 106, 0.2);
            color: var(--terracotta);
        }

        .filter-options,
        .date-filter {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-options select,
        .date-filter input {
            padding: 8px 16px;
            border: 1px solid var(--stone);
            border-radius: 4px;
            background: var(--white);
            color: var(--text-dark);
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: var(--spacing-md);
        }

        .search-box input {
            flex: 1;
            padding: 12px 20px;
            border: 1px solid var(--stone);
            border-radius: 50px;
            font-size: 15px;
        }

        .search-box button {
            background: var(--ochre);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: var(--spacing-md);
        }

        .page-btn {
            padding: 8px 16px;
            border: 1px solid var(--stone);
            background: var(--white);
            border-radius: 4px;
            cursor: pointer;
        }

        .page-btn.active {
            background: var(--ochre);
            color: white;
            border-color: var(--ochre);
        }

        @media (max-width: 1024px) {
            .admin-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: var(--spacing-sm) 0;
            }

            .sidebar-menu {
                display: flex;
                overflow-x: auto;
                gap: 8px;
                padding: 0 20px;
            }

            .sidebar-menu li {
                margin-bottom: 0;
            }

            .sidebar-menu a {
                white-space: nowrap;
                border-left: none;
                border-bottom: 3px solid transparent;
            }

            .sidebar-menu a.active {
                border-left-color: transparent;
                border-bottom-color: var(--terracotta);
            }
        }

        @media (max-width: 768px) {
            nav {
                padding: 0 20px;
            }

            .main-content {
                padding: var(--spacing-md) var(--spacing-sm);
            }

            .section-title {
                font-size: 28px;
            }

            .section-header {
                flex-direction: column;
                gap: var(--spacing-sm);
                align-items: flex-start;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: var(--spacing-md);
            }

            .modal-title {
                font-size: 24px;
            }

            table {
                font-size: 14px;
            }

            th,
            td {
                padding: 12px 16px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: var(--spacing-sm);
            }
        }

        @media (max-width: 600px) {
            .logo {
                font-size: 20px;
            }

            .admin-actions span {
                display: none;
            }

            .table-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .action-btn {
                padding: 6px 12px;
                font-size: 12px;
                margin-bottom: 4px;
            }
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <div class="logo">
                <span>Even</span><span style="color: var(--deep-brown)">Travel</span>
            </div>
            <div class="admin-actions">
                <span id="currentUser">Administrateur</span>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Déconnexion
                </button>
            </div>
        </nav>
    </header>

    <div class="admin-container">
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li>
                    <a href="#" class="active" data-section="dashboard">
                        <i class="fas fa-chart-line"></i> Tableau de Bord
                    </a>
                </li>
                <li>
                    <a href="#" data-section="events">
                        <i class="fas fa-calendar-alt"></i> Événements
                    </a>
                </li>
                <li>
                    <a href="#" data-section="destinations">
                        <i class="fas fa-map-marked-alt"></i> Destinations
                    </a>
                </li>
                <li>
                    <a href="#" data-section="blogs">
                        <i class="fas fa-blog"></i> Articles
                    </a>
                </li>
                <li>
                    <a href="#" data-section="comments">
                        <i class="fas fa-comments"></i> Commentaires
                    </a>
                </li>
                <li>
                    <a href="#" data-section="payments">
                        <i class="fas fa-credit-card"></i> Paiements
                    </a>
                </li>
                <li>
                    <a href="#" data-section="reservations">
                        <i class="fas fa-calendar-check"></i> Réservations
                    </a>
                </li>
            </ul>
        </aside>

        <main class="main-content">
            <section id="dashboard" class="dashboard-section active">
                <div class="section-header">
                    <h1 class="section-title">Tableau de Bord</h1>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div class="stat-number" id="totalReservations">
                            0
                        </div>
                        <div class="stat-label">Réservations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-number" id="totalEvents">0</div>
                        <div class="stat-label">Événements Actifs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-globe-africa"></i>
                        </div>
                        <div class="stat-number" id="totalDestinations">
                            0
                        </div>
                        <div class="stat-label">Destinations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-comment-dots"></i>
                        </div>
                        <div class="stat-number" id="totalComments">0</div>
                        <div class="stat-label">Commentaires</div>
                    </div>
                </div>
            </section>

            <section id="events" class="dashboard-section">
                <div class="section-header">
                    <h1 class="section-title">Gestion des Événements</h1>
                    <button class="add-btn" onclick="openAddModal('event')">
                        <i class="fas fa-plus"></i> Ajouter un Événement
                    </button>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Liste des Événements</h3>
                        <button class="export-btn" onclick="exportToCSV('events')">
                            <i class="fas fa-download"></i> Exporter CSV
                        </button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Titre</th>
                                <th>Date</th>
                                <th>Lieu</th>
                                <th>Prix</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="eventsTableBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="destinations" class="dashboard-section">
                <div class="section-header">
                    <h1 class="section-title">Gestion des Destinations</h1>
                    <button class="add-btn" onclick="openAddModal('destination')">
                        <i class="fas fa-plus"></i> Ajouter une Destination
                    </button>
                </div>

                <div class="search-box">
                    <input type="text" id="destinationSearch" placeholder="Rechercher une destination..."
                        onkeyup="searchDestinations()">
                    <button onclick="searchDestinations()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Liste des Destinations</h3>
                        <div class="filter-options">
                            <select id="destinationFilter" onchange="filterDestinations()">
                                <option value="all">Toutes les catégories</option>
                                <option value="weekend">Weekend</option>
                                <option value="culture">Culture</option>
                                <option value="nature">Nature</option>
                                <option value="aventure">Aventure</option>
                            </select>
                            <button class="export-btn" onclick="exportToCSV('destinations')">
                                <i class="fas fa-download"></i> Exporter CSV
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Titre</th>
                                <th>Localisation</th>
                                <th>Prix</th>
                                <th>Catégorie</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="destinationsTableBody"></tbody>
                    </table>
                    <div class="pagination" id="destinationsPagination"></div>
                </div>
            </section>

            <section id="blogs" class="dashboard-section">
                <div class="section-header">
                    <h1 class="section-title">Gestion des Articles</h1>
                    <button class="add-btn" onclick="openAddModal('blog')">
                        <i class="fas fa-plus"></i> Ajouter un Article
                    </button>
                </div>

                <div class="search-box">
                    <input type="text" id="blogSearch" placeholder="Rechercher un article..." onkeyup="searchBlogs()">
                    <button onclick="searchBlogs()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Liste des Articles</h3>
                        <div class="filter-options">
                            <select id="blogStatusFilter" onchange="filterBlogs()">
                                <option value="all">Tous les statuts</option>
                                <option value="published">Publié</option>
                                <option value="draft">Brouillon</option>
                            </select>
                            <button class="export-btn" onclick="exportToCSV('blogs')">
                                <i class="fas fa-download"></i> Exporter CSV
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Titre</th>
                                <th>Auteur</th>
                                <th>Date</th>
                                <th>Catégorie</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="blogsTableBody"></tbody>
                    </table>
                    <div class="pagination" id="blogsPagination"></div>
                </div>
            </section>

            <section id="comments" class="dashboard-section">
                <div class="section-header">
                    <h1 class="section-title">Gestion des Commentaires</h1>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Commentaires récents</h3>
                        <div class="filter-options">
                            <select id="commentFilter" onchange="filterComments()">
                                <option value="all">Tous les commentaires</option>
                                <option value="pending">En attente</option>
                                <option value="approved">Approuvés</option>
                                <option value="rejected">Rejetés</option>
                            </select>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Utilisateur</th>
                                <th>Article</th>
                                <th>Commentaire</th>
                                <th>Date</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="commentsTableBody"></tbody>
                    </table>
                    <div class="pagination" id="commentsPagination"></div>
                </div>
            </section>

            <section id="payments" class="dashboard-section">
                <div class="section-header">
                    <h1 class="section-title">Gestion des Paiements</h1>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Historique des transactions</h3>
                        <div class="date-filter">
                            <input type="date" id="startDate" onchange="filterPayments()">
                            <span>au</span>
                            <input type="date" id="endDate" onchange="filterPayments()">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Référence</th>
                                <th>Client</th>
                                <th>Événement</th>
                                <th>Montant</th>
                                <th>Date</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsTableBody"></tbody>
                    </table>
                    <div class="pagination" id="paymentsPagination"></div>
                </div>
            </section>
            <section id="reservations" class="dashboard-section">
                <div class="section-header">
                    <h1 class="section-title">Gestion des Réservations</h1>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Réservations récentes</h3>
                        <div class="filter-options">
                            <select id="reservationStatusFilter" onchange="filterReservations()">
                                <option value="all">Tous les statuts</option>
                                <option value="en_attente">En attente</option>
                                <option value="acompte">Acompte</option>
                                <option value="paye">Payé</option>
                                <option value="annule">Annulé</option>
                            </select>
                            <button class="export-btn" onclick="exportToCSV('reservations')">
                                <i class="fas fa-download"></i> Exporter CSV
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Référence</th>
                                <th>Client</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Places</th>
                                <th>Montant Total</th>
                                <th>Montant Payé</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="reservationsTableBody"></tbody>
                    </table>
                    <div class="pagination" id="reservationsPagination"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODAL ÉVÉNEMENT COMPLET -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="eventModalTitle" class="modal-title">Ajouter un Événement</h2>
                <button class="close-btn" onclick="closeModal('eventModal')">×</button>
            </div>
            <form id="eventForm">
                <input type="hidden" id="eventId">

                <!-- Section Informations Générales -->
                <div class="form-section">
                    <h3 class="section-title-small">Informations Générales</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventNom">Nom de l'événement *</label>
                            <input type="text" id="eventNom" data-required>
                        </div>
                        <div class="form-group">
                            <label for="eventCategorie">Catégorie *</label>
                            <select id="eventCategorie" data-required>
                                <option value="concert">Concert</option>
                                <option value="festival">Festival</option>
                                <option value="culture">Culturel</option>
                                <option value="sport">Sportif</option>
                                <option value="excursion">Excursion</option>
                                <option value="formation">Formation</option>
                                <option value="soiree">Soirée</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="eventDescription">Description courte *</label>
                        <textarea id="eventDescription" data-required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="eventDescriptionLongue">Description longue</label>
                        <textarea id="eventDescriptionLongue"></textarea>
                    </div>
                </div>

                <!-- Section Dates et Lieu -->
                <div class="form-section">
                    <h3 class="section-title-small">Dates et Lieu</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventDate">Date de début *</label>
                            <input type="datetime-local" id="eventDate" data-required>
                        </div>
                        <div class="form-group">
                            <label for="eventDateFin">Date de fin</label>
                            <input type="datetime-local" id="eventDateFin">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventDuree">Durée (jours) *</label>
                            <input type="number" id="eventDuree" min="1" value="1" data-required>
                        </div>
                        <div class="form-group">
                            <label for="eventLieu">Lieu *</label>
                            <input type="text" id="eventLieu" data-required>
                        </div>
                    </div>
                </div>

                <!-- Section Tarifs et Capacité -->
                <div class="form-section">
                    <h3 class="section-title-small">Tarifs et Capacité</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventPrix">Prix (FCFA) *</label>
                            <input type="number" id="eventPrix" min="0" step="1000" data-required>
                        </div>
                        <div class="form-group">
                            <label for="eventPlacesTotales">Places totales *</label>
                            <input type="number" id="eventPlacesTotales" min="1" value="500" data-required>
                        </div>
                    </div>
                </div>

                <!-- Section Configuration du Groupe -->
                <div class="form-section">
                    <h3 class="section-title-small">Configuration du Groupe</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventTailleGroupeMin">Taille groupe min</label>
                            <input type="number" id="eventTailleGroupeMin" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="eventTailleGroupeMax">Taille groupe max</label>
                            <input type="number" id="eventTailleGroupeMax" min="1" value="20">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventDifficulte">Difficulté</label>
                            <select id="eventDifficulte">
                                <option value="Très facile">Très facile</option>
                                <option value="Facile">Facile</option>
                                <option value="Modérée" selected>Modérée</option>
                                <option value="Difficile">Difficile</option>
                                <option value="Très difficile">Très difficile</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="eventLangues">Langues parlées</label>
                            <input type="text" id="eventLangues" placeholder="Français, Anglais...">
                        </div>
                    </div>
                </div>

                <!-- Section Services -->
                <div class="form-section">
                    <h3 class="section-title-small">Services Inclus</h3>
                    <div class="form-array" id="servicesInclusContainer">
                        <div class="array-item" data-index="0">
                            <div class="array-header">
                                <strong>Service 1</strong>
                                <button type="button" class="remove-array-item"
                                    onclick="removeArrayItem('servicesInclus', 0)">×</button>
                            </div>
                            <input type="text" class="service-inclus-input" data-index="0"
                                placeholder="Ex: Hébergement inclus">
                        </div>
                    </div>
                    <button type="button" class="add-array-btn" onclick="addArrayItem('servicesInclus')">+ Ajouter un
                        service inclus</button>
                </div>

                <div class="form-section">
                    <h3 class="section-title-small">Services Non Inclus</h3>
                    <div class="form-array" id="servicesNonInclusContainer">
                        <div class="array-item" data-index="0">
                            <div class="array-header">
                                <strong>Service non inclus 1</strong>
                                <button type="button" class="remove-array-item"
                                    onclick="removeArrayItem('servicesNonInclus', 0)">×</button>
                            </div>
                            <input type="text" class="service-noninclus-input" data-index="0"
                                placeholder="Ex: Billets d'avion">
                        </div>
                    </div>
                    <button type="button" class="add-array-btn" onclick="addArrayItem('servicesNonInclus')">+ Ajouter un
                        service non inclus</button>
                </div>

                <!-- Section Moments Forts -->
                <div class="form-section">
                    <h3 class="section-title-small">Moments Forts</h3>
                    <div class="form-array" id="momentsFortsContainer">
                        <div class="array-item" data-index="0">
                            <div class="array-header">
                                <strong>Moment fort 1</strong>
                                <button type="button" class="remove-array-item"
                                    onclick="removeArrayItem('momentsForts', 0)">×</button>
                            </div>
                            <input type="text" class="moment-fort-input" data-index="0"
                                placeholder="Ex: Cérémonie traditionnelle">
                        </div>
                    </div>
                    <button type="button" class="add-array-btn" onclick="addArrayItem('momentsForts')">+ Ajouter un
                        moment fort</button>
                </div>

                <!-- Section Itinéraire -->
                <div class="form-section">
                    <h3 class="section-title-small">Itinéraire</h3>
                    <div class="form-array" id="itineraireContainer">
                        <div class="array-item" data-index="0">
                            <div class="array-header">
                                <strong>Jour 1</strong>
                                <button type="button" class="remove-array-item"
                                    onclick="removeArrayItem('itineraire', 0)">×</button>
                            </div>
                            <div class="form-group">
                                <label>Titre du jour</label>
                                <input type="text" class="itineraire-titre" data-index="0"
                                    placeholder="Ex: Arrivée et découverte">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea class="itineraire-description" data-index="0"
                                    placeholder="Description détaillée de la journée"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Activités (séparées par des virgules)</label>
                                <input type="text" class="itineraire-activites" data-index="0"
                                    placeholder="Visite, Repas, Découverte...">
                            </div>
                        </div>
                    </div>
                    <button type="button" class="add-array-btn" onclick="addArrayItem('itineraire')">+ Ajouter un
                        jour</button>
                </div>

                <!-- Section Informations Pratiques -->
                <div class="form-section">
                    <h3 class="section-title-small">Informations Pratiques</h3>
                    <div class="form-group">
                        <label for="eventInformationsPratiques">Informations à connaître avant de partir</label>
                        <textarea id="eventInformationsPratiques"
                            placeholder="Tenue vestimentaire, vaccinations, recommandations..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="eventRecommandations">Recommandations supplémentaires</label>
                        <textarea id="eventRecommandations"
                            placeholder="Conseils pour profiter au maximum de l'événement"></textarea>
                    </div>
                </div>

                <!-- Section Options -->
                <div class="form-section">
                    <h3 class="section-title-small">Options</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventFeatured">
                                <input type="checkbox" id="eventFeatured"> Mettre en vedette
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="eventImage">Image principale</label>
                            <input type="file" id="eventImage" accept="image/*">
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="cancel-modal-btn" onclick="closeModal('eventModal')">
                        Annuler
                    </button>
                    <button type="submit" class="save-btn">
                        Enregistrer l'Événement
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL DESTINATION -->
    <div id="destinationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="destinationModalTitle" class="modal-title">Ajouter une Destination</h2>
                <button class="close-btn" onclick="closeModal('destinationModal')">×</button>
            </div>
            <form id="destinationForm">
                <input type="hidden" id="destinationId">

                <div class="form-section">
                    <h3 class="section-title-small">Informations Générales</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="destinationTitre">Titre *</label>
                            <input type="text" id="destinationTitre" data-required>
                        </div>
                        <div class="form-group">
                            <label for="destinationCategorie">Catégorie *</label>
                            <select id="destinationCategorie" data-required>
                                <option value="weekend">Weekend</option>
                                <option value="culture">Culture</option>
                                <option value="nature">Nature</option>
                                <option value="aventure">Aventure</option>
                                <option value="plage">Plage</option>
                                <option value="montagne">Montagne</option>
                                <option value="urbain">Urbain</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="destinationDescription">Description *</label>
                        <textarea id="destinationDescription" data-required></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="destinationLocalisation">Localisation *</label>
                            <input type="text" id="destinationLocalisation" data-required>
                        </div>
                        <div class="form-group">
                            <label for="destinationPrix">Prix (FCFA) *</label>
                            <input type="number" id="destinationPrix" min="0" step="1000" data-required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title-small">Dates Disponibles</h3>
                    <div class="form-array" id="datesDisponiblesContainer">
                        <div class="array-item" data-index="0">
                            <div class="array-header">
                                <strong>Période 1</strong>
                                <button type="button" class="remove-array-item"
                                    onclick="removeArrayItem('datesDisponibles', 0)">×</button>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date de début</label>
                                    <input type="date" class="date-debut-input" data-index="0">
                                </div>
                                <div class="form-group">
                                    <label>Date de fin</label>
                                    <input type="date" class="date-fin-input" data-index="0">
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="add-array-btn" onclick="addArrayItem('datesDisponibles')">
                        + Ajouter une période
                    </button>
                </div>
                <!-- Ajoutez cette section après la section "Dates Disponibles" -->
                <div class="form-section">
                    <h3 class="section-title-small">Informations Géographiques</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="destinationPays">Pays *</label>
                            <input type="text" id="destinationPays" data-required>
                        </div>
                        <div class="form-group">
                            <label for="destinationRegion">Région</label>
                            <input type="text" id="destinationRegion">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="destinationClimat">Climat</label>
                            <input type="text" id="destinationClimat" value="Tropical">
                        </div>
                        <div class="form-group">
                            <label for="destinationFuseauHoraire">Fuseau horaire</label>
                            <input type="text" id="destinationFuseauHoraire" value="GMT+1">
                        </div>
                    </div>
                </div>

                <!-- Section Informations Climatiques -->
                <div class="form-section">
                    <h3 class="section-title-small">Informations Climatiques</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="destinationTemperatureMin">Température min (°C)</label>
                            <input type="number" id="destinationTemperatureMin" value="25">
                        </div>
                        <div class="form-group">
                            <label for="destinationTemperatureMax">Température max (°C)</label>
                            <input type="number" id="destinationTemperatureMax" value="32">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="destinationDevise">Devise</label>
                            <input type="text" id="destinationDevise" value="Franc CFA (XOF)">
                        </div>
                        <div class="form-group">
                            <label for="destinationMeilleurePeriode">Meilleure période</label>
                            <input type="text" id="destinationMeilleurePeriode" value="Novembre - Mars">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="destinationBudgetJournalier">Budget journalier</label>
                            <input type="text" id="destinationBudgetJournalier" value="50-100€">
                        </div>
                        <div class="form-group">
                            <label for="destinationAeroport">Aéroport principal</label>
                            <input type="text" id="destinationAeroport">
                        </div>
                    </div>
                </div>

                <!-- Section Langues -->
                <div class="form-section">
                    <h3 class="section-title-small">Langues parlées</h3>
                    <div class="form-array" id="languesContainer">
                        <div class="array-item" data-index="0">
                            <div class="array-header">
                                <strong>Langue 1</strong>
                                <button type="button" class="remove-array-item"
                                    onclick="removeArrayItem('langues', 0)">×</button>
                            </div>
                            <input type="text" class="langue-input" data-index="0" value="Français">
                        </div>
                    </div>
                    <button type="button" class="add-array-btn" onclick="addArrayItem('langues')">
                        + Ajouter une langue
                    </button>
                </div>

                <!-- Section Sites à visiter -->
                <div class="form-section">
                    <h3 class="section-title-small">Sites à visiter</h3>
                    <div class="form-array" id="sitesVisiterContainer">
                        <div class="array-item" data-index="0">
                            <div class="array-header">
                                <strong>Site 1</strong>
                                <button type="button" class="remove-array-item"
                                    onclick="removeArrayItem('sitesVisiter', 0)">×</button>
                            </div>
                            <input type="text" class="site-visiter-input" data-index="0" placeholder="Ex: Musée Honmè">
                        </div>
                    </div>
                    <button type="button" class="add-array-btn" onclick="addArrayItem('sitesVisiter')">
                        + Ajouter un site
                    </button>
                </div>

                <!-- Section Gastronomie -->
                <div class="form-section">
                    <h3 class="section-title-small">Spécialités gastronomiques</h3>
                    <div class="form-array" id="gastronomieContainer">
                        <div class="array-item" data-index="0">
                            <div class="array-header">
                                <strong>Spécialité 1</strong>
                                <button type="button" class="remove-array-item"
                                    onclick="removeArrayItem('gastronomie', 0)">×</button>
                            </div>
                            <input type="text" class="gastronomie-input" data-index="0" placeholder="Ex: Akassa">
                        </div>
                    </div>
                    <button type="button" class="add-array-btn" onclick="addArrayItem('gastronomie')">
                        + Ajouter une spécialité
                    </button>
                </div>

                <!-- Section Informations détaillées -->
                <div class="form-section">
                    <h3 class="section-title-small">Informations détaillées</h3>
                    <div class="form-group">
                        <label for="destinationDescriptionLongue">Description longue</label>
                        <textarea id="destinationDescriptionLongue" rows="6"
                            placeholder="Description détaillée de la destination..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="destinationExperiencesCulturelles">Expériences culturelles</label>
                        <textarea id="destinationExperiencesCulturelles" rows="4"
                            placeholder="Décrivez les expériences culturelles uniques..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="destinationInformationsPratiques">Informations pratiques</label>
                        <textarea id="destinationInformationsPratiques" rows="4"
                            placeholder="Informations pratiques pour les voyageurs..."></textarea>
                    </div>
                </div>

                <!-- Section SEO -->
                <div class="form-section">
                    <h3 class="section-title-small">Optimisation SEO</h3>
                    <div class="form-group">
                        <label for="destinationMetaDescription">Meta description</label>
                        <textarea id="destinationMetaDescription" rows="3"
                            placeholder="Description pour les moteurs de recherche..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="destinationMotsCles">Mots-clés (séparés par des virgules)</label>
                        <input type="text" id="destinationMotsCles" placeholder="voyage, culture, afrique, bénin...">
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title-small">Options</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="destinationPlacesDisponibles">Places disponibles *</label>
                            <input type="number" id="destinationPlacesDisponibles" min="1" value="50" data-required>
                        </div>
                        <div class="form-group">
                            <label for="destinationFeatured">
                                <input type="checkbox" id="destinationFeatured">
                                Mettre en vedette
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="destinationImage">Image principale</label>
                        <input type="file" id="destinationImage" accept="image/*">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="cancel-modal-btn" onclick="closeModal('destinationModal')">
                        Annuler
                    </button>
                    <button type="submit" class="save-btn">
                        Enregistrer la Destination
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL ARTICLE -->
    <div id="blogModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="blogModalTitle" class="modal-title">Ajouter un Article</h2>
                <button class="close-btn" onclick="closeModal('blogModal')">×</button>
            </div>
            <form id="blogForm">
                <input type="hidden" id="blogId">

                <div class="form-section">
                    <h3 class="section-title-small">Informations Générales</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="blogTitre">Titre *</label>
                            <input type="text" id="blogTitre" data-required>
                        </div>
                        <div class="form-group">
                            <label for="blogCategorie">Catégorie *</label>
                            <select id="blogCategorie" data-required>
                                <option value="voyage">Voyage</option>
                                <option value="culture">Culture</option>
                                <option value="aventure">Aventure</option>
                                <option value="conseils">Conseils</option>
                                <option value="evenements">Événements</option>
                                <option value="autre">Autres</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="blogAuteur">Auteur *</label>
                            <input type="text" id="blogAuteur" data-required>
                        </div>
                        <div class="form-group">
                            <label for="blogStatut">Statut *</label>
                            <select id="blogStatut" data-required>
                                <option value="draft">Brouillon</option>
                                <option value="published">Publié</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="blogDescriptionCourte">Description courte *</label>
                        <textarea id="blogDescriptionCourte" data-required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="blogContenu">Contenu *</label>
                        <textarea id="blogContenu" rows="10" data-required></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title-small">Médias</h3>
                    <div class="form-group">
                        <label for="blogImage">Image principale</label>
                        <input type="file" id="blogImages" accept="image/*">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="cancel-modal-btn" onclick="closeModal('blogModal')">
                        Annuler
                    </button>
                    <button type="submit" class="save-btn">
                        Enregistrer l'Article
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL CONFIRMATION -->
    <div id="confirmModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">Confirmation</h2>
                <button class="close-btn" onclick="closeModal('confirmModal')">×</button>
            </div>
            <div class="form-section">
                <p id="confirmMessage">Êtes-vous sûr de vouloir effectuer cette action ?</p>
            </div>
            <div class="modal-actions">
                <button type="button" class="cancel-modal-btn" onclick="closeModal('confirmModal')">
                    Annuler
                </button>
                <button type="button" class="save-btn" id="confirmActionBtn" onclick="executeConfirmedAction()">
                    Confirmer
                </button>
            </div>
        </div>
    </div>
    <!-- MODAL DÉTAILS RÉSERVATION -->
    <div id="reservationDetailModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 id="reservationDetailModalTitle" class="modal-title">Détails de la Réservation</h2>
                <button class="close-btn" onclick="closeModal('reservationDetailModal')">×</button>
            </div>
            <div class="form-section">
                <div id="reservationDetails"></div>
            </div>
            <div class="modal-actions">
                <button type="button" class="cancel-modal-btn" onclick="closeModal('reservationDetailModal')">
                    Fermer
                </button>
                <button type="button" class="save-btn" id="changeStatusBtn" style="display: none;">
                    Changer le statut
                </button>
            </div>
        </div>
    </div>

<script>
    // Définition de l'URL de base globale
   // const BASE_URL = "https://even-travel-backend.onrender.com/api/v1";
    // Alternative pour développement local:
     const BASE_URL = "http://localhost:5000/api/v1";

    (function () {
        const token = localStorage.getItem("authToken");

        if (!token) {
            window.location.replace("admin-login.html");
            return;
        }
    })();

    let currentPage = {
        destinations: 1,
        blogs: 1,
        comments: 1,
        payments: 1,
        reservations: 1
    };
    const itemsPerPage = 10;

    document.addEventListener("DOMContentLoaded", function () {
        loadDashboardData();
        setupNavigation();
        setupFormSubmissions();
        loadInitialData();
    });

    function setupNavigation() {
        const navLinks = document.querySelectorAll(".sidebar-menu a");
        navLinks.forEach((link) => {
            link.addEventListener("click", function (e) {
                e.preventDefault();
                const section = this.getAttribute("data-section");
                navLinks.forEach((l) => l.classList.remove("active"));
                this.classList.add("active");
                document.querySelectorAll(".dashboard-section").forEach((s) => s.classList.remove("active"));
                document.getElementById(section).classList.add("active");
                
                // Charger les données de la section si nécessaire
                if (section === "reservations" && document.getElementById("reservationsTableBody").innerHTML.includes("Chargement")) {
                    loadReservations();
                }
            });
        });
    }

    async function loadDashboardData() {
        await updateStats();
    }

    async function updateStats() {
        try {
            const token = localStorage.getItem("authToken");

            // Réservations
            try {
                const reservationsResponse = await fetch(
                    `${BASE_URL}/reservations/stats`,
                    {
                        headers: {
                            Authorization: `Bearer ${token}`,
                        },
                    },
                );

                if (reservationsResponse.ok) {
                    const reservationsData = await reservationsResponse.json();
                    const totalReservations = reservationsData.data?.stats?.totalReservations || 0;
                    document.getElementById("totalReservations").textContent = totalReservations;
                }
            } catch (reservationsError) {
                console.log("Endpoint réservations non disponible");
            }

            // Événements
            const eventsResponse = await fetch(
                `${BASE_URL}/events`,
                {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                },
            );

            if (eventsResponse.ok) {
                const eventsData = await eventsResponse.json();
                const totalEvents = eventsData?.data?.events?.length || 0;
                const activeEvents = eventsData?.data?.events?.filter((e) => e.featured === true).length || 0;
                document.getElementById("totalEvents").textContent = activeEvents;
            }

            // Destinations
            const destinationsResponse = await fetch(
                `${BASE_URL}/destinations`,
                {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                },
            );

            if (destinationsResponse.ok) {
                const destinationsData = await destinationsResponse.json();
                const totalDestinations = destinationsData?.data?.destinations?.length || 0;
                document.getElementById("totalDestinations").textContent = totalDestinations;
            }

            // Commentaires
            try {
                const commentsResponse = await fetch(
                    `${BASE_URL}/admin/comments`,
                    {
                        headers: {
                            Authorization: `Bearer ${token}`,
                        },
                    },
                );

                if (commentsResponse.ok) {
                    const commentsData = await commentsResponse.json();
                    const totalComments = commentsData?.data?.comments?.length || 0;
                    document.getElementById("totalComments").textContent = totalComments;
                }
            } catch (commentsError) {
                console.log("Endpoint commentaires non disponible");
            }

        } catch (error) {
            console.error("Erreur lors du chargement des statistiques:", error);
        }
    }

    function loadInitialData() {
        loadEvents();
        loadDestinations();
        loadBlogs();
        loadComments();
        loadPayments();
        loadReservations();
    }

    // ========== GESTION DES ÉVÉNEMENTS ==========
    async function loadEvents() {
        const tbody = document.getElementById("eventsTableBody");
        tbody.innerHTML = `<tr><td colspan="6">Chargement des événements...</td></tr>`;

        try {
            const token = localStorage.getItem("authToken");
            const response = await fetch(
                `${BASE_URL}/events`,
                {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                },
            );

            if (!response.ok) throw new Error("Erreur lors du chargement des événements");

            const result = await response.json();
            const events = result?.data?.events || [];

            if (events.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6">Aucun événement disponible</td></tr>`;
                return;
            }

            tbody.innerHTML = "";

            events.forEach((event) => {
                const isActive = event.featured === true;
                const statusClass = isActive ? "status-active" : "status-inactive";

                const row = `
                        <tr>
                            <td>${event.nom}</td>
                            <td>${new Date(event.date).toLocaleDateString("fr-FR")}</td>
                            <td>${event.lieu}</td>
                            <td>${event.prix ? event.prix.toLocaleString("fr-FR") + " FCFA" : "Gratuit"}</td>
                            <td>
                                <span class="status-badge ${statusClass}">
                                    ${isActive ? "Actif" : "Inactif"}
                                </span>
                            </td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editEvent('${event._id}')">
                                    Modifier
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('event', '${event._id}')">
                                    Supprimer
                                </button>
                            </td>
                        </tr>
                    `;

                tbody.insertAdjacentHTML("beforeend", row);
            });
        } catch (error) {
            console.error("Erreur loadEvents:", error);
            tbody.innerHTML = `<tr><td colspan="6">Erreur lors du chargement des événements</td></tr>`;
        }
    }

    function openAddModal(type) {
        if (type === 'event') {
            document.getElementById("eventModalTitle").textContent = "Ajouter un Événement";
            document.getElementById("eventId").value = "";
            document.getElementById("eventForm").reset();
            clearArray('servicesInclus');
            clearArray('servicesNonInclus');
            clearArray('momentsForts');
            clearArray('itineraire');
            document.getElementById("eventModal").classList.add("show");
        } else if (type === 'destination') {
            document.getElementById("destinationModalTitle").textContent = "Ajouter une Destination";
            document.getElementById("destinationId").value = "";
            document.getElementById("destinationForm").reset();
            clearArray('datesDisponibles');
            clearArray('langues');
            clearArray('sitesVisiter');
            clearArray('gastronomie');
            document.getElementById("destinationModal").classList.add("show");
        } else if (type === 'blog') {
            document.getElementById("blogModalTitle").textContent = "Ajouter un Article";
            document.getElementById("blogId").value = "";
            document.getElementById("blogForm").reset();
            document.getElementById("blogModal").classList.add("show");
        }
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("show");
    }

    async function editEvent(id) {
        try {
            const token = localStorage.getItem("authToken");
            const response = await fetch(
                `${BASE_URL}/events/${id}`,
                {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                },
            );

            if (!response.ok) throw new Error("Erreur lors du chargement des données");

            const result = await response.json();
            const event = result.data?.event || result.data;

            document.getElementById("eventModalTitle").textContent = "Modifier l'Événement";
            document.getElementById("eventId").value = id;

            // Remplir le formulaire complet
            populateEventForm(event);

            document.getElementById("eventModal").classList.add("show");
        } catch (error) {
            console.error("Erreur editEvent:", error);
            alert("Erreur lors du chargement des données");
        }
    }

    function populateEventForm(event) {
        // Informations générales
        document.getElementById("eventNom").value = event.nom || "";
        document.getElementById("eventCategorie").value = event.categorie || "concert";
        document.getElementById("eventDescription").value = event.description || "";
        document.getElementById("eventDescriptionLongue").value = event.descriptionLongue || "";

        // Dates et lieu
        if (event.date) {
            const dateObj = new Date(event.date);
            const localDate = dateObj.toISOString().slice(0, 16);
            document.getElementById("eventDate").value = localDate;
        }

        if (event.dateFin) {
            const dateFinObj = new Date(event.dateFin);
            const localDateFin = dateFinObj.toISOString().slice(0, 16);
            document.getElementById("eventDateFin").value = localDateFin;
        }

        document.getElementById("eventDuree").value = event.duree || 1;
        document.getElementById("eventLieu").value = event.lieu || "";

        // Tarifs et capacité
        document.getElementById("eventPrix").value = event.prix || "";
        document.getElementById("eventPlacesTotales").value = event.placesTotales || 500;

        // Configuration du groupe
        document.getElementById("eventTailleGroupeMin").value = event.tailleGroupeMin || 1;
        document.getElementById("eventTailleGroupeMax").value = event.tailleGroupeMax || 20;
        document.getElementById("eventDifficulte").value = event.difficulte || "Modérée";
        document.getElementById("eventLangues").value = event.langues ? event.langues.join(', ') : "";

        // Services inclus
        if (event.servicesInclus && event.servicesInclus.length > 0) {
            clearArray('servicesInclus');
            event.servicesInclus.forEach((service, index) => {
                if (index === 0) {
                    document.querySelector('.service-inclus-input').value = service;
                } else {
                    addArrayItem('servicesInclus', service);
                }
            });
        }

        // Services non inclus
        if (event.servicesNonInclus && event.servicesNonInclus.length > 0) {
            clearArray('servicesNonInclus');
            event.servicesNonInclus.forEach((service, index) => {
                if (index === 0) {
                    document.querySelector('.service-noninclus-input').value = service;
                } else {
                    addArrayItem('servicesNonInclus', service);
                }
            });
        }

        // Moments forts
        if (event.momentsForts && event.momentsForts.length > 0) {
            clearArray('momentsForts');
            event.momentsForts.forEach((moment, index) => {
                if (index === 0) {
                    document.querySelector('.moment-fort-input').value = moment;
                } else {
                    addArrayItem('momentsForts', moment);
                }
            });
        }

        // Itinéraire
        if (event.itineraire && event.itineraire.length > 0) {
            clearArray('itineraire');
            event.itineraire.forEach((jour, index) => {
                if (index === 0) {
                    document.querySelector('.itineraire-titre').value = jour.titre || '';
                    document.querySelector('.itineraire-description').value = jour.description || '';
                    document.querySelector('.itineraire-activites').value = jour.activites ? jour.activites.join(', ') : '';
                } else {
                    addArrayItem('itineraire', jour);
                }
            });
        }

        // Informations pratiques
        document.getElementById("eventInformationsPratiques").value = event.informationsPratiques || "";
        document.getElementById("eventRecommandations").value = event.recommandations || "";

        // Options
        document.getElementById("eventFeatured").checked = event.featured || false;
    }

    // ========== GESTION DES DESTINATIONS ==========
    async function loadDestinations(page = 1) {
        const tbody = document.getElementById("destinationsTableBody");
        tbody.innerHTML = `<tr><td colspan="6">Chargement des destinations...</td></tr>`;

        try {
            const token = localStorage.getItem("authToken");
            const response = await fetch(
                `${BASE_URL}/destinations`,
                {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                },
            );

            if (!response.ok) throw new Error("Erreur lors du chargement des destinations");

            const result = await response.json();
            const destinations = result?.data?.destinations || [];
            currentPage.destinations = page;

            if (destinations.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6">Aucune destination disponible</td></tr>`;
                document.getElementById("destinationsPagination").innerHTML = "";
                return;
            }

            // Pagination
            const totalPages = Math.ceil(destinations.length / itemsPerPage);
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedDestinations = destinations.slice(startIndex, endIndex);

            tbody.innerHTML = "";

            paginatedDestinations.forEach((destination) => {
                const isFeatured = destination.featured === true;
                const statusClass = isFeatured ? "status-active" : "status-inactive";

                const row = `
                        <tr>
                            <td>${destination.titre}</td>
                            <td>${destination.localisation}</td>
                            <td>${destination.prix ? destination.prix.toLocaleString("fr-FR") + " FCFA" : "Gratuit"}</td>
                            <td>${destination.categorie}</td>
                            <td>
                                <span class="status-badge ${statusClass}">
                                    ${isFeatured ? "En vedette" : "Standard"}
                                </span>
                            </td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editDestination('${destination._id}')">
                                    Modifier
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('destination', '${destination._id}')">
                                    Supprimer
                                </button>
                            </td>
                        </tr>
                    `;

                tbody.insertAdjacentHTML("beforeend", row);
            });

            // Afficher la pagination
            renderPagination('destinations', totalPages, page);
        } catch (error) {
            console.error("Erreur loadDestinations:", error);
            tbody.innerHTML = `<tr><td colspan="6">Erreur lors du chargement des destinations</td></tr>`;
        }
    }

    async function editDestination(id) {
        try {
            const token = localStorage.getItem("authToken");
            const response = await fetch(
                `${BASE_URL}/destinations/${id}`,
                {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                },
            );

            if (!response.ok) throw new Error("Erreur lors du chargement des données");

            const result = await response.json();
            const destination = result.data?.destination || result.data;

            document.getElementById("destinationModalTitle").textContent = "Modifier la Destination";
            document.getElementById("destinationId").value = id;

            // Remplir le formulaire
            document.getElementById("destinationTitre").value = destination.titre || "";
            document.getElementById("destinationCategorie").value = destination.categorie || "weekend";
            document.getElementById("destinationDescription").value = destination.description || "";
            document.getElementById("destinationLocalisation").value = destination.localisation || "";
            document.getElementById("destinationPrix").value = destination.prix || "";
            document.getElementById("destinationPlacesDisponibles").value = destination.placesDisponibles || 50;
            document.getElementById("destinationFeatured").checked = destination.featured || false;

            // Champs géographiques
            document.getElementById("destinationPays").value = destination.pays || "";
            document.getElementById("destinationRegion").value = destination.region || "";
            document.getElementById("destinationClimat").value = destination.climat || "Tropical";
            document.getElementById("destinationFuseauHoraire").value = destination.fuseauHoraire || "GMT+1";
            document.getElementById("destinationTemperatureMin").value = destination.temperatureMin || 25;
            document.getElementById("destinationTemperatureMax").value = destination.temperatureMax || 32;
            document.getElementById("destinationDevise").value = destination.devise || "Franc CFA (XOF)";
            document.getElementById("destinationMeilleurePeriode").value = destination.meilleurePeriode || "Novembre - Mars";
            document.getElementById("destinationBudgetJournalier").value = destination.budgetJournalier || "50-100€";
            document.getElementById("destinationAeroport").value = destination.aeroport || "";

            // Informations détaillées
            document.getElementById("destinationDescriptionLongue").value = destination.descriptionLongue || "";
            document.getElementById("destinationExperiencesCulturelles").value = destination.experiencesCulturelles || "";
            document.getElementById("destinationInformationsPratiques").value = destination.informationsPratiques || "";

            // SEO
            document.getElementById("destinationMetaDescription").value = destination.metaDescription || "";
            document.getElementById("destinationMotsCles").value = destination.motsCles ? destination.motsCles.join(', ') : "";

            // Dates disponibles
            clearArray('datesDisponibles');
            if (destination.datesDisponibles && destination.datesDisponibles.length > 0) {
                destination.datesDisponibles.forEach((date, index) => {
                    if (index === 0) {
                        document.querySelector(".date-debut-input").value = date.debut ? new Date(date.debut).toISOString().split('T')[0] : "";
                        document.querySelector(".date-fin-input").value = date.fin ? new Date(date.fin).toISOString().split('T')[0] : "";
                    } else {
                        addArrayItem('datesDisponibles', date);
                    }
                });
            }

            // Langues
            clearArray('langues');
            if (destination.langues && destination.langues.length > 0) {
                destination.langues.forEach((langue, index) => {
                    if (index === 0) {
                        document.querySelector('.langue-input').value = langue;
                    } else {
                        addArrayItem('langues', langue);
                    }
                });
            }

            // Sites à visiter
            clearArray('sitesVisiter');
            if (destination.sitesVisiter && destination.sitesVisiter.length > 0) {
                destination.sitesVisiter.forEach((site, index) => {
                    if (index === 0) {
                        document.querySelector('.site-visiter-input').value = site;
                    } else {
                        addArrayItem('sitesVisiter', site);
                    }
                });
            }

            // Gastronomie
            clearArray('gastronomie');
            if (destination.gastronomie && destination.gastronomie.length > 0) {
                destination.gastronomie.forEach((specialite, index) => {
                    if (index === 0) {
                        document.querySelector('.gastronomie-input').value = specialite;
                    } else {
                        addArrayItem('gastronomie', specialite);
                    }
                });
            }

            document.getElementById("destinationModal").classList.add("show");
        } catch (error) {
            console.error("Erreur editDestination:", error);
            alert("Erreur lors du chargement des données");
        }
    }

    // ========== GESTION DES ARTICLES ==========
    async function loadBlogs(page = 1) {
        const tbody = document.getElementById("blogsTableBody");
        tbody.innerHTML = `<tr><td colspan="6">Chargement des articles...</td></tr>`;

        try {
            const token = localStorage.getItem("authToken");
            const response = await fetch(
                `${BASE_URL}/admin/articles`,
                {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                },
            );

            if (!response.ok) throw new Error("Erreur lors du chargement des articles");

            const result = await response.json();
            const blogs = result?.data?.articles || [];
            currentPage.blogs = page;

            if (blogs.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6">Aucun article disponible</td></tr>`;
                document.getElementById("blogsPagination").innerHTML = "";
                return;
            }

            // Pagination
            const totalPages = Math.ceil(blogs.length / itemsPerPage);
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedBlogs = blogs.slice(startIndex, endIndex);

            tbody.innerHTML = "";

            paginatedBlogs.forEach((blog) => {
                const statusClass = blog.statut === 'published' ? 'status-published' : 'status-draft';

                const row = `
                        <tr>
                            <td>${blog.titre}</td>
                            <td>${blog.auteur}</td>
                            <td>${new Date(blog.datePublication || blog.createdAt).toLocaleDateString("fr-FR")}</td>
                            <td>${blog.categorie}</td>
                            <td>
                                <span class="status-badge ${blog.published ? 'published' : 'draft'}">
                                ${blog.published ? 'Publié' : 'Brouillon'}
                                </span>
                            </td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editBlog('${blog._id}')">
                                    Modifier
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('blog', '${blog._id}')">
                                    Supprimer
                                </button>
                            </td>
                        </tr>
                    `;

                tbody.insertAdjacentHTML("beforeend", row);
            });

            // Afficher la pagination
            renderPagination('blogs', totalPages, page);
        } catch (error) {
            console.error("Erreur loadBlogs:", error);
            tbody.innerHTML = `<tr><td colspan="6">Erreur lors du chargement des articles</td></tr>`;
        }
    }

    async function editBlog(id) {
        try {
            const token = localStorage.getItem("authToken");
            const response = await fetch(
                `${BASE_URL}/admin/articles/${id}`,
                {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                },
            );

            if (!response.ok) throw new Error("Erreur lors du chargement des données");

            const result = await response.json();
            const blog = result.data?.article || result.data;

            document.getElementById("blogModalTitle").textContent = "Modifier l'Article";
            document.getElementById("blogId").value = id;

            // Remplir le formulaire
            document.getElementById("blogTitre").value = blog.titre || "";
            document.getElementById("blogCategorie").value = blog.categorie || "voyage";
            document.getElementById("blogAuteur").value = blog.auteur || "";
            document.getElementById("blogStatut").value = blog.statut || "draft";
            document.getElementById("blogDescriptionCourte").value = blog.descriptionCourte || "";
            document.getElementById("blogContenu").value = blog.contenu || "";

            document.getElementById("blogModal").classList.add("show");
        } catch (error) {
            console.error("Erreur editBlog:", error);
            alert("Erreur lors du chargement des données");
        }
    }

    // ========== GESTION DES COMMENTAIRES ==========
    async function loadComments(page = 1) {
        const tbody = document.getElementById("commentsTableBody");
        tbody.innerHTML = `<tr><td colspan="6">Chargement des commentaires...</td></tr>`;

        try {
            const token = localStorage.getItem("authToken");
            const response = await fetch(
                `${BASE_URL}/admin/comments`,
                {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                },
            );

            if (!response.ok) throw new Error("Erreur lors du chargement des commentaires");

            const result = await response.json();
            const comments = result?.data?.comments || [];
            currentPage.comments = page;

            if (comments.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6">Aucun commentaire disponible</td></tr>`;
                document.getElementById("commentsPagination").innerHTML = "";
                return;
            }

            // Pagination
            const totalPages = Math.ceil(comments.length / itemsPerPage);
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedComments = comments.slice(startIndex, endIndex);

            tbody.innerHTML = "";

            paginatedComments.forEach((comment) => {
                const statusClass = comment.statut === 'approved' ? 'status-approved' :
                    comment.statut === 'rejected' ? 'status-cancelled' : 'status-pending';

                const statusText = comment.statut === 'approved' ? 'Approuvé' :
                    comment.statut === 'rejected' ? 'Rejeté' : 'En attente';

                const row = `
                        <tr>
                            <td>${comment.utilisateur || comment.nom || 'Anonyme'}</td>
                            <td>${comment.article?.titre || 'Non spécifié'}</td>
                            <td>${comment.message?.substring(0, 50)}${comment.message.length > 50 ? '...' : ''}</td>
                            <td>${new Date(comment.date || comment.createdAt).toLocaleDateString("fr-FR")}</td>
                            <td>
                                <span class="status-badge ${statusClass}">
                                    ${statusText}
                                </span>
                            </td>
                            <td>
                                <button class="action-btn edit-btn" onclick="moderateComment('${comment._id}', 'approved')">
                                    Approuver
                                </button>
                                <button class="action-btn delete-btn" onclick="moderateComment('${comment._id}', 'rejected')">
                                    Rejeter
                                </button>
                            </td>
                        </tr>
                    `;

                tbody.insertAdjacentHTML("beforeend", row);
            });

            // Afficher la pagination
            renderPagination('comments', totalPages, page);
        } catch (error) {
            console.error("Erreur loadComments:", error);
            tbody.innerHTML = `<tr><td colspan="6">Erreur lors du chargement des commentaires</td></tr>`;
        }
    }

    async function moderateComment(id, action) {
        try {
            const token = localStorage.getItem("authToken");
            const response = await fetch(
                `${BASE_URL}/admin/comments/${id}/approve`,
                {
                    method: "PATCH",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${token}`,
                    },
                    body: JSON.stringify({ statut: action }),
                },
            );

            if (!response.ok) throw new Error("Erreur lors de la modération du commentaire");

            await loadComments(currentPage.comments);
            updateStats();
            alert(`Commentaire ${action === 'approved' ? 'approuvé' : 'rejeté'} avec succès!`);
        } catch (error) {
            console.error("Erreur moderateComment:", error);
            alert("Erreur lors de la modération du commentaire");
        }
    }

    // ========== GESTION DES PAIEMENTS ==========
    async function loadPayments(page = 1) {
    const tbody = document.getElementById("paymentsTableBody");
    tbody.innerHTML = `<tr><td colspan="7">Chargement des paiements...</td></tr>`;

    try {
        const token = localStorage.getItem("authToken");
        const response = await fetch(
        `${BASE_URL}/reservations`,
        {
            headers: {
            Authorization: `Bearer ${token}`,
            },
        },
        );

        if (!response.ok) throw new Error("Erreur lors du chargement des paiements");

        const result = await response.json();
        const reservations = result?.data?.reservations || [];
        
        // Filtrer pour n'avoir que les réservations avec paiement
        const paymentsData = reservations.filter(r => r.statutPaiement && r.statutPaiement !== 'en_attente');
        
        currentPage.payments = page;

        if (paymentsData.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7">Aucun paiement disponible</td></tr>`;
        document.getElementById("paymentsPagination").innerHTML = "";
        return;
        }

        // Pagination
        const totalPages = Math.ceil(paymentsData.length / itemsPerPage);
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const paginatedPayments = paymentsData.slice(startIndex, endIndex);

        tbody.innerHTML = "";

        paginatedPayments.forEach((reservation) => {
        const statusClass = getReservationStatusClass(reservation.statutPaiement);
        const statusText = getReservationStatusText(reservation.statutPaiement);

        const row = `
            <tr>
            <td>${reservation._id.substring(0, 8)}...</td>
            <td>${reservation.client?.prenom || ''} ${reservation.client?.nom || ''}</td>
            <td>${reservation.type === 'event' ? 'Événement' : 'Destination'}</td>
            <td>${reservation.montantTotal ? reservation.montantTotal.toLocaleString("fr-FR") + " FCFA" : '0 FCFA'}</td>
            <td>${new Date(reservation.createdAt).toLocaleDateString("fr-FR")}</td>
            <td>
                <span class="status-badge ${statusClass}">
                ${statusText}
                </span>
            </td>
            <td>
                <button class="action-btn edit-btn" onclick="viewReservation('${reservation._id}')">
                Détails
                </button>
            </td>
            </tr>
        `;

        tbody.insertAdjacentHTML("beforeend", row);
        });

        // Afficher la pagination
        renderPagination('payments', totalPages, page);
    } catch (error) {
        console.error("Erreur loadPayments:", error);
        tbody.innerHTML = `<tr><td colspan="7">Erreur lors du chargement des paiements</td></tr>`;
    }
    }

    function viewPayment(id) {
        alert(`Voir les détails du paiement ${id}`);
        // Implémentez cette fonction selon vos besoins
    }

    // ========== FONCTIONS DE FORMULAIRES ==========
    function setupFormSubmissions() {
        // Événements
        document.getElementById("eventForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            await saveEvent();
        });

        // Destinations
        document.getElementById("destinationForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            await saveDestination();
        });

        // Articles
        document.getElementById("blogForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            await saveBlog();
        });
    }

    async function saveEvent() {
        const id = document.getElementById("eventId").value;

        // Validation des champs requis
        const requiredFields = document.querySelectorAll('#eventForm [data-required]');
        let isValid = true;
        let errorMessage = '';

        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                isValid = false;
                errorMessage += `Le champ "${field.previousElementSibling?.textContent || field.id}" est requis.\n`;
                field.style.borderColor = 'red';
            } else {
                field.style.borderColor = '';
            }
        });

        if (!isValid) {
            alert(errorMessage);
            return;
        }

        // Créer un FormData pour envoyer les fichiers
        const formData = new FormData();

        // Ajouter l'image si fournie
        const imageFile = document.getElementById("eventImage").files[0];
        if (imageFile) {
            formData.append('image', imageFile);
        }

        // Récupérer les autres données
        const servicesInclus = getArrayValues('servicesInclus');
        const servicesNonInclus = getArrayValues('servicesNonInclus');
        const momentsForts = getArrayValues('momentsForts');
        const itineraire = getArrayValues('itineraire');

        // Traiter les langues
        const languesInput = document.getElementById("eventLangues").value;
        const langues = languesInput ? languesInput.split(',').map(l => l.trim()).filter(l => l) : ['Français'];

        // Traiter les dates
        const dateInput = document.getElementById("eventDate").value;
        const dateFinInput = document.getElementById("eventDateFin").value;
        const duree = parseInt(document.getElementById("eventDuree").value) || 1;

        let dateFin;
        if (dateFinInput) {
            dateFin = new Date(dateFinInput).toISOString();
        } else if (dateInput && duree > 1) {
            const date = new Date(dateInput);
            date.setDate(date.getDate() + duree - 1);
            dateFin = date.toISOString();
        } else {
            dateFin = dateInput ? new Date(dateInput).toISOString() : new Date().toISOString();
        }

        // Créer l'objet de données
        const eventData = {
            nom: document.getElementById("eventNom").value,
            date: dateInput ? new Date(dateInput).toISOString() : new Date().toISOString(),
            dateFin: dateFin,
            lieu: document.getElementById("eventLieu").value,
            description: document.getElementById("eventDescription").value,
            descriptionLongue: document.getElementById("eventDescriptionLongue").value || document.getElementById("eventDescription").value,
            prix: parseInt(document.getElementById("eventPrix").value) || 0,
            placesTotales: parseInt(document.getElementById("eventPlacesTotales").value) || 500,
            placesRestantes: parseInt(document.getElementById("eventPlacesTotales").value) || 500,
            duree: duree,
            tailleGroupeMin: parseInt(document.getElementById("eventTailleGroupeMin").value) || 1,
            tailleGroupeMax: parseInt(document.getElementById("eventTailleGroupeMax").value) || 20,
            difficulte: document.getElementById("eventDifficulte").value,
            langues: langues,
            categorie: document.getElementById("eventCategorie").value,
            featured: document.getElementById("eventFeatured").checked,
            servicesInclus: servicesInclus,
            servicesNonInclus: servicesNonInclus,
            informationsPratiques: document.getElementById("eventInformationsPratiques").value,
            itineraire: itineraire,
            momentsForts: momentsForts,
            recommandations: document.getElementById("eventRecommandations").value
        };

        // Ajouter les données JSON au FormData
        formData.append('data', JSON.stringify(eventData));

        try {
            const token = localStorage.getItem("authToken");
            const url = id ?
                `${BASE_URL}/events/${id}` :
                `${BASE_URL}/events`;

            const response = await fetch(url, {
                method: id ? "PATCH" : "POST",
                headers: {
                    "Authorization": `Bearer ${token}`,
                },  
                body: formData,
            });

            if (!response.ok) {
            const text = await response.text();
            throw new Error(text || "Erreur lors de l'enregistrement");
            }


            closeModal('eventModal');
            await loadEvents();
            updateStats();
            alert(`Événement ${id ? 'modifié' : 'ajouté'} avec succès!`);
        } catch (error) {
            console.error("Erreur saveEvent:", error);
            alert("Erreur: " + error.message);
        }
    }

    async function saveDestination() {
        const id = document.getElementById("destinationId").value;

        // Validation des champs requis
        const requiredFields = document.querySelectorAll('#destinationForm [data-required]');
        let isValid = true;
        let errorMessage = '';

        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                isValid = false;
                errorMessage += `Le champ "${field.previousElementSibling?.textContent || field.id}" est requis.\n`;
                field.style.borderColor = 'red';
            } else {
                field.style.borderColor = '';
            }
        });

        if (!isValid) {
            alert(errorMessage);
            return;
        }

        // Créer FormData pour les fichiers
        const formData = new FormData();

        // Ajouter l'image si fournie
        const imageFile = document.getElementById("destinationImage").files[0];
        if (imageFile) {
            formData.append('image', imageFile);
        }

        // Récupérer les valeurs des tableaux
        const datesDisponibles = getArrayValues('datesDisponibles');
        const langues = getArrayValues('langues');
        const sitesVisiter = getArrayValues('sitesVisiter');
        const gastronomie = getArrayValues('gastronomie');

        // Traiter les mots-clés
        const motsClesInput = document.getElementById("destinationMotsCles").value;
        const motsCles = motsClesInput ? motsClesInput.split(',').map(m => m.trim()).filter(m => m) : [];

        // Créer l'objet de données
        const destinationData = {
            titre: document.getElementById("destinationTitre").value,
            categorie: document.getElementById("destinationCategorie").value,
            description: document.getElementById("destinationDescription").value,
            descriptionLongue: document.getElementById("destinationDescriptionLongue").value,
            localisation: document.getElementById("destinationLocalisation").value,
            pays: document.getElementById("destinationPays").value,
            region: document.getElementById("destinationRegion").value,
            prix: parseInt(document.getElementById("destinationPrix").value) || 0,
            placesDisponibles: parseInt(document.getElementById("destinationPlacesDisponibles").value) || 50,
            featured: document.getElementById("destinationFeatured").checked,
            datesDisponibles: datesDisponibles.filter(date => date.debut && date.fin),

            // Nouveaux champs
            climat: document.getElementById("destinationClimat").value,
            temperatureMin: parseInt(document.getElementById("destinationTemperatureMin").value) || 25,
            temperatureMax: parseInt(document.getElementById("destinationTemperatureMax").value) || 32,
            devise: document.getElementById("destinationDevise").value,
            langues: langues,
            aeroport: document.getElementById("destinationAeroport").value,
            fuseauHoraire: document.getElementById("destinationFuseauHoraire").value,
            meilleurePeriode: document.getElementById("destinationMeilleurePeriode").value,
            budgetJournalier: document.getElementById("destinationBudgetJournalier").value,

            // Informations détaillées
            sitesVisiter: sitesVisiter,
            experiencesCulturelles: document.getElementById("destinationExperiencesCulturelles").value,
            gastronomie: gastronomie,
            informationsPratiques: document.getElementById("destinationInformationsPratiques").value,

            // SEO
            metaDescription: document.getElementById("destinationMetaDescription").value,
            motsCles: motsCles
        };

        // Ajouter les données JSON au FormData
        formData.append('data', JSON.stringify(destinationData));

        try {
            const token = localStorage.getItem("authToken");
            const url = id ?
                `${BASE_URL}/destinations/${id}` :
                `${BASE_URL}/destinations`;

            const response = await fetch(url, {
                method: id ? "PATCH" : "POST",
                headers: {
                    "Authorization": `Bearer ${token}`,
                },
                body: formData,
            });
            console.log(response)

            if (!response.ok) {
                const error = await response;
                console.log(response)
                throw new Error(error.message || "Erreur lors de l'enregistrement");
            }

            closeModal('destinationModal');
            await loadDestinations(currentPage.destinations);
            updateStats();
            alert(`Destination ${id ? 'modifiée' : 'ajoutée'} avec succès!`);
        } catch (error) {
            console.error("Erreur saveDestination:", error);
            alert("Erreur lors de l'enregistrement: " + error.message);
        }
    }

    async function saveBlog() {
        const id = document.getElementById("blogId").value;

        // Validation des champs requis
        const requiredFields = document.querySelectorAll('#blogForm [data-required]');
        let isValid = true;
        let errorMessage = '';

        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                isValid = false;
                errorMessage += `Le champ "${field.previousElementSibling?.textContent || field.id}" est requis.\n`;
                field.style.borderColor = 'red';
            } else {
                field.style.borderColor = '';
            }
        });

        if (!isValid) {
            alert(errorMessage);
            return;
        }

        // Créer FormData
        const formData = new FormData();

        // Ajouter les images (IMPORTANT : nom "images")
        const imageFiles = document.getElementById("blogImages").files;
        for (let i = 0; i < imageFiles.length; i++) {
            formData.append('images', imageFiles[i]);
        }

        // Créer l'objet de données
        const blogData = {
            titre: document.getElementById("blogTitre").value,
            contenu: document.getElementById("blogContenu").value,
            auteur: document.getElementById("blogAuteur").value,
            categorie:document.getElementById("blogCategorie").value,
            published: document.getElementById("blogStatut").value === 'published'
        };

        // AJOUTER LES CHAMPS DIRECTEMENT AU FormData (pas besoin de JSON)
        formData.append('titre', blogData.titre);
        formData.append('contenu', blogData.contenu);
        formData.append('auteur', blogData.auteur);
        formData.append('categorie', blogData.categorie);
        formData.append('published', blogData.published);

        try {
            const token = localStorage.getItem("authToken");
            const url = id ?
                `${BASE_URL}/admin/articles/${id}` :
                `${BASE_URL}/admin/articles`;

            console.log("Envoi de la requête avec FormData:", {
                titre: blogData.titre,
                auteur: blogData.auteur,
                nombreImages: imageFiles.length
            });

            const response = await fetch(url, {
                method: id ? "PATCH" : "POST",
                headers: {
                    "Authorization": `Bearer ${token}`,
                },
                body: formData,
            });

            const responseText = await response.text();
            console.log("Réponse brute:", responseText);

            if (!response.ok) {
                throw new Error(`Erreur ${response.status}: ${responseText}`);
            }

            // Essayer de parser le JSON
            try {
                const result = JSON.parse(responseText);
                console.log("Réponse JSON:", result);
            } catch (e) {
                console.log("Réponse non-JSON:", responseText);
            }

            closeModal('blogModal');
            await loadBlogs(currentPage.blogs);
            updateStats();
            alert(`Article ${id ? 'modifié' : 'ajouté'} avec succès!`);
        } catch (error) {
            console.error("Erreur détaillée saveBlog:", error);
            alert("Erreur lors de l'enregistrement: " + error.message);
        }
    }

    // ========== FONCTIONS DE SUPPRESSION ==========
    let pendingDelete = { type: null, id: null };

    function deleteItem(type, id) {
        pendingDelete = { type, id };

        const typeLabels = {
            'event': 'cet événement',
            'destination': 'cette destination',
            'blog': 'cet article',
            'comment': 'ce commentaire',
            'payment': 'ce paiement',
            'reservation': 'cette réservation'
        };

        document.getElementById("confirmMessage").textContent =
            `Êtes-vous sûr de vouloir supprimer ${typeLabels[type]} ? Cette action est irréversible.`;

        document.getElementById("confirmActionBtn").textContent = "Supprimer";
        document.getElementById("confirmModal").classList.add("show");
    }

    async function executeConfirmedAction() {
        if (!pendingDelete.type || !pendingDelete.id) return;

        const { type, id } = pendingDelete;

        try {
            const token = localStorage.getItem("authToken");
            let url, method;

            switch (type) {
                case 'event':
                    url = `${BASE_URL}/events/${id}`;
                    method = "DELETE";
                    break;
                case 'destination':
                    url = `${BASE_URL}/destinations/${id}`;
                    method = "DELETE";
                    break;
                case 'blog':
                    url = `${BASE_URL}/admin/articles/${id}`;
                    method = "DELETE";
                    break;
                case 'comment':
                    url = `${BASE_URL}/admin/comments/${id}`;
                    method = "DELETE";
                    break;
                case 'reservation':
                    url = `${BASE_URL}/reservations/${id}`;
                    method = "DELETE";
                    break;
                default:
                    throw new Error("Type non supporté");
            }

            const response = await fetch(url, {
                method: method,
                headers: {
                    Authorization: `Bearer ${token}`,
                },
            });

            if (!response.ok) throw new Error("Erreur lors de la suppression");

            closeModal('confirmModal');

            // Recharger les données
            switch (type) {
                case 'event':
                    await loadEvents();
                    break;
                case 'destination':
                    await loadDestinations(currentPage.destinations);
                    break;
                case 'blog':
                    await loadBlogs(currentPage.blogs);
                    break;
                case 'comment':
                    await loadComments(currentPage.comments);
                    break;
                case 'reservation':
                    await loadReservations(currentPage.reservations);
                    break;
            }

            updateStats();
            alert("Suppression effectuée avec succès!");
        } catch (error) {
            console.error("Erreur deleteItem:", error);
            alert("Erreur lors de la suppression");
        } finally {
            pendingDelete = { type: null, id: null };
        }
    }

    // ========== FONCTIONS UTILITAIRES ==========
    function addArrayItem(type, defaultValue = '') {
        const container = document.getElementById(`${type}Container`);
        const items = container.querySelectorAll(".array-item");
        const newIndex = items.length;

        let html = "";
        if (type === 'servicesInclus') {
            html = `
                    <div class="array-item" data-index="${newIndex}">
                        <div class="array-header">
                            <strong>Service ${newIndex + 1}</strong>
                            <button type="button" class="remove-array-item" onclick="removeArrayItem('${type}', ${newIndex})">×</button>
                        </div>
                        <input type="text" class="service-inclus-input" data-index="${newIndex}" value="${defaultValue}" placeholder="Ex: Hébergement inclus">
                    </div>
                `;
        } else if (type === 'servicesNonInclus') {
            html = `
                    <div class="array-item" data-index="${newIndex}">
                        <div class="array-header">
                            <strong>Service non inclus ${newIndex + 1}</strong>
                            <button type="button" class="remove-array-item" onclick="removeArrayItem('${type}', ${newIndex})">×</button>
                        </div>
                        <input type="text" class="service-noninclus-input" data-index="${newIndex}" value="${defaultValue}" placeholder="Ex: Billets d'avion">
                    </div>
                `;
        } else if (type === 'momentsForts') {
            html = `
                    <div class="array-item" data-index="${newIndex}">
                        <div class="array-header">
                            <strong>Moment fort ${newIndex + 1}</strong>
                            <button type="button" class="remove-array-item" onclick="removeArrayItem('${type}', ${newIndex})">×</button>
                        </div>
                        <input type="text" class="moment-fort-input" data-index="${newIndex}" value="${defaultValue}" placeholder="Ex: Cérémonie traditionnelle">
                    </div>
                `;
        } else if (type === 'itineraire') {
            const jourData = typeof defaultValue === 'object' ? defaultValue : {};
            html = `
                    <div class="array-item" data-index="${newIndex}">
                        <div class="array-header">
                            <strong>Jour ${newIndex + 1}</strong>
                            <button type="button" class="remove-array-item" onclick="removeArrayItem('${type}', ${newIndex})">×</button>
                        </div>
                        <div class="form-group">
                            <label>Titre du jour</label>
                            <input type="text" class="itineraire-titre" data-index="${newIndex}" value="${jourData.titre || ''}" placeholder="Ex: Arrivée et découverte">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea class="itineraire-description" data-index="${newIndex}" placeholder="Description détaillée de la journée">${jourData.description || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Activités (séparées par des virgules)</label>
                            <input type="text" class="itineraire-activites" data-index="${newIndex}" value="${jourData.activites ? jourData.activites.join(', ') : ''}" placeholder="Visite, Repas, Découverte...">
                        </div>
                    </div>
                `;
        } else if (type === 'datesDisponibles') {
            const dateData = typeof defaultValue === 'object' ? defaultValue : {};
            html = `
                    <div class="array-item" data-index="${newIndex}">
                        <div class="array-header">
                            <strong>Période ${newIndex + 1}</strong>
                            <button type="button" class="remove-array-item" onclick="removeArrayItem('${type}', ${newIndex})">×</button>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Date de début</label>
                                <input type="date" class="date-debut-input" data-index="${newIndex}" value="${dateData.debut ? new Date(dateData.debut).toISOString().split('T')[0] : ''}">
                            </div>
                            <div class="form-group">
                                <label>Date de fin</label>
                                <input type="date" class="date-fin-input" data-index="${newIndex}" value="${dateData.fin ? new Date(dateData.fin).toISOString().split('T')[0] : ''}">
                            </div>
                        </div>
                    </div>
                `;
        } else if (type === 'langues') {
            html = `
                    <div class="array-item" data-index="${newIndex}">
                        <div class="array-header">
                            <strong>Langue ${newIndex + 1}</strong>
                            <button type="button" class="remove-array-item" onclick="removeArrayItem('${type}', ${newIndex})">×</button>
                        </div>
                        <input type="text" class="langue-input" data-index="${newIndex}" value="${defaultValue || 'Français'}" placeholder="Ex: Français">
                    </div>
                `;
        } else if (type === 'sitesVisiter') {
            html = `
                    <div class="array-item" data-index="${newIndex}">
                        <div class="array-header">
                            <strong>Site ${newIndex + 1}</strong>
                            <button type="button" class="remove-array-item" onclick="removeArrayItem('${type}', ${newIndex})">×</button>
                        </div>
                        <input type="text" class="site-visiter-input" data-index="${newIndex}" value="${defaultValue}" placeholder="Ex: Musée Honmè">
                    </div>
                `;
        } else if (type === 'gastronomie') {
            html = `
                    <div class="array-item" data-index="${newIndex}">
                        <div class="array-header">
                            <strong>Spécialité ${newIndex + 1}</strong>
                            <button type="button" class="remove-array-item" onclick="removeArrayItem('${type}', ${newIndex})">×</button>
                        </div>
                        <input type="text" class="gastronomie-input" data-index="${newIndex}" value="${defaultValue}" placeholder="Ex: Akassa">
                    </div>
                `;
        }

        if (html) {
            container.insertAdjacentHTML("beforeend", html);
        }
    }

    function removeArrayItem(type, index) {
        const container = document.getElementById(`${type}Container`);
        const item = container.querySelector(`.array-item[data-index="${index}"]`);
        if (item) item.remove();

        // Réindexer
        const items = container.querySelectorAll(".array-item");
        items.forEach((item, newIndex) => {
            item.setAttribute("data-index", newIndex);
            const header = item.querySelector(".array-header strong");
            const removeBtn = item.querySelector(".remove-array-item");

            if (header) {
                if (type === 'servicesInclus') header.textContent = `Service ${newIndex + 1}`;
                else if (type === 'servicesNonInclus') header.textContent = `Service non inclus ${newIndex + 1}`;
                else if (type === 'momentsForts') header.textContent = `Moment fort ${newIndex + 1}`;
                else if (type === 'itineraire') header.textContent = `Jour ${newIndex + 1}`;
                else if (type === 'datesDisponibles') header.textContent = `Période ${newIndex + 1}`;
                else if (type === 'langues') header.textContent = `Langue ${newIndex + 1}`;
                else if (type === 'sitesVisiter') header.textContent = `Site ${newIndex + 1}`;
                else if (type === 'gastronomie') header.textContent = `Spécialité ${newIndex + 1}`;
            }

            if (removeBtn) removeBtn.setAttribute("onclick", `removeArrayItem('${type}', ${newIndex})`);

            item.querySelectorAll("input, textarea").forEach(input => {
                input.setAttribute("data-index", newIndex);
            });
        });
    }

    function getArrayValues(type) {
        const container = document.getElementById(`${type}Container`);
        const inputs = container.querySelectorAll('input, textarea');
        const values = [];

        // Grouper les valeurs par index
        const groupedByIndex = {};

        inputs.forEach(input => {
            const index = input.getAttribute('data-index');
            if (!groupedByIndex[index]) {
                groupedByIndex[index] = {};
            }

            const className = input.className;
            if (className.includes('service-inclus-input')) {
                groupedByIndex[index].value = input.value;
            } else if (className.includes('service-noninclus-input')) {
                groupedByIndex[index].value = input.value;
            } else if (className.includes('moment-fort-input')) {
                groupedByIndex[index].value = input.value;
            } else if (className.includes('itineraire-titre')) {
                groupedByIndex[index].titre = input.value;
            } else if (className.includes('itineraire-description')) {
                groupedByIndex[index].description = input.value;
            } else if (className.includes('itineraire-activites')) {
                groupedByIndex[index].activites = input.value.split(',').map(a => a.trim()).filter(a => a);
            } else if (className.includes('date-debut-input')) {
                groupedByIndex[index].debut = input.value;
            } else if (className.includes('date-fin-input')) {
                groupedByIndex[index].fin = input.value;
            } else if (className.includes('langue-input')) {
                groupedByIndex[index].value = input.value;
            } else if (className.includes('site-visiter-input')) {
                groupedByIndex[index].value = input.value;
            } else if (className.includes('gastronomie-input')) {
                groupedByIndex[index].value = input.value;
            }
        });

        // Convertir en format approprié
        Object.values(groupedByIndex).forEach(item => {
            if (type === 'itineraire') {
                if (item.titre || item.description) {
                    values.push({
                        jour: parseInt(Object.keys(groupedByIndex).find(key => groupedByIndex[key] === item)) + 1,
                        titre: item.titre || '',
                        description: item.description || '',
                        activites: item.activites || []
                    });
                }
            } else if (type === 'datesDisponibles') {
                if (item.debut && item.fin) {
                    values.push({
                        debut: new Date(item.debut).toISOString(),
                        fin: new Date(item.fin).toISOString()
                    });
                }
            } else {
                if (item.value && item.value.trim()) {
                    values.push(item.value.trim());
                }
            }
        });

        return values;
    }

    function clearArray(type) {
        const container = document.getElementById(`${type}Container`);
        const items = container.querySelectorAll('.array-item');

        // Garder seulement le premier élément
        items.forEach((item, index) => {
            if (index > 0) {
                item.remove();
            }
        });

        // Réinitialiser le premier élément
        const firstItem = container.querySelector('.array-item');
        if (firstItem) {
            firstItem.setAttribute('data-index', '0');
            const inputs = firstItem.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.value = '';
                input.setAttribute('data-index', '0');
            });

            const header = firstItem.querySelector('.array-header strong');
            const removeBtn = firstItem.querySelector('.remove-array-item');

            switch (type) {
                case 'servicesInclus':
                    header.textContent = 'Service 1';
                    break;
                case 'servicesNonInclus':
                    header.textContent = 'Service non inclus 1';
                    break;
                case 'momentsForts':
                    header.textContent = 'Moment fort 1';
                    break;
                case 'itineraire':
                    header.textContent = 'Jour 1';
                    break;
                case 'datesDisponibles':
                    header.textContent = 'Période 1';
                    break;
                case 'langues':
                    header.textContent = 'Langue 1';
                    break;
                case 'sitesVisiter':
                    header.textContent = 'Site 1';
                    break;
                case 'gastronomie':
                    header.textContent = 'Spécialité 1';
                    break;
            }

            if (removeBtn) {
                removeBtn.setAttribute('onclick', `removeArrayItem('${type}', 0)`);
            }
        }
    }

    function renderPagination(type, totalPages, currentPage) {
        const container = document.getElementById(`${type}Pagination`);
        if (totalPages <= 1) {
            container.innerHTML = "";
            return;
        }

        let html = "";
        const maxVisible = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
        let endPage = Math.min(totalPages, startPage + maxVisible - 1);

        if (endPage - startPage + 1 < maxVisible) {
            startPage = Math.max(1, endPage - maxVisible + 1);
        }

        if (startPage > 1) {
            html += `<button class="page-btn" onclick="changePage('${type}', 1)">1</button>`;
            if (startPage > 2) html += `<span>...</span>`;
        }

        for (let i = startPage; i <= endPage; i++) {
            html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage('${type}', ${i})">${i}</button>`;
        }

        if (endPage < totalPages) {
            if (endPage < totalPages - 1) html += `<span>...</span>`;
            html += `<button class="page-btn" onclick="changePage('${type}', ${totalPages})">${totalPages}</button>`;
        }

        container.innerHTML = html;
    }

    function changePage(type, page) {
        switch (type) {
            case 'destinations':
                loadDestinations(page);
                break;
            case 'blogs':
                loadBlogs(page);
                break;
            case 'comments':
                loadComments(page);
                break;
            case 'payments':
                loadPayments(page);
                break;
            case 'reservations':
                loadReservations(page);
                break;
        }
    }

    function searchDestinations() {
        const searchTerm = document.getElementById("destinationSearch").value.toLowerCase();
        const rows = document.querySelectorAll("#destinationsTableBody tr");

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? "" : "none";
        });
    }

    function filterDestinations() {
        const filter = document.getElementById("destinationFilter").value;
        const rows = document.querySelectorAll("#destinationsTableBody tr");

        rows.forEach(row => {
            if (filter === 'all') {
                row.style.display = "";
            } else {
                const categoryCell = row.querySelector("td:nth-child(4)");
                if (categoryCell && categoryCell.textContent.toLowerCase() === filter) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            }
        });
    }

    function searchBlogs() {
        const searchTerm = document.getElementById("blogSearch").value.toLowerCase();
        const rows = document.querySelectorAll("#blogsTableBody tr");

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? "" : "none";
        });
    }

    function filterBlogs() {
        const filter = document.getElementById("blogStatusFilter").value;
        const rows = document.querySelectorAll("#blogsTableBody tr");

        rows.forEach(row => {
            if (filter === 'all') {
                row.style.display = "";
            } else {
                const statusBadge = row.querySelector(".status-badge");
                if (statusBadge) {
                    const status = statusBadge.textContent.toLowerCase().trim();
                    const filterStatus = filter === 'published' ? 'publié' : 'brouillon';
                    row.style.display = status === filterStatus ? "" : "none";
                }
            }
        });
    }

    function filterComments() {
        const filter = document.getElementById("commentFilter").value;
        const rows = document.querySelectorAll("#commentsTableBody tr");

        rows.forEach(row => {
            if (filter === 'all') {
                row.style.display = "";
            } else {
                const statusBadge = row.querySelector(".status-badge");
                if (statusBadge) {
                    const status = statusBadge.textContent.toLowerCase().trim();
                    const filterStatus = filter === 'approved' ? 'approuvé' :
                        filter === 'rejected' ? 'rejeté' : 'en attente';
                    row.style.display = status === filterStatus ? "" : "none";
                }
            }
        });
    }

    function filterPayments() {
        const startDate = document.getElementById("startDate").value;
        const endDate = document.getElementById("endDate").value;
        const rows = document.querySelectorAll("#paymentsTableBody tr");

        if (!startDate && !endDate) {
            rows.forEach(row => row.style.display = "");
            return;
        }

        const start = startDate ? new Date(startDate) : null;
        const end = endDate ? new Date(endDate) : null;

        rows.forEach(row => {
            const dateCell = row.querySelector("td:nth-child(5)");
            if (dateCell) {
                const date = new Date(dateCell.textContent);
                const show = (!start || date >= start) && (!end || date <= end);
                row.style.display = show ? "" : "none";
            }
        });
    }

    function exportToCSV(type) {
        alert(`Export ${type} CSV - À implémenter`);
    }

    function logout() {
        if (!confirm("Êtes-vous sûr de vouloir vous déconnecter ?")) return;

        localStorage.removeItem("authToken");
        window.location.href = "admin-login.html";
    }

    // ========== GESTION DES RÉSERVATIONS ==========
    async function loadReservations(page = 1) {
        const tbody = document.getElementById("reservationsTableBody");
        tbody.innerHTML = `<tr><td colspan="9">Chargement des réservations...</td></tr>`;

        try {
            const token = localStorage.getItem("authToken");
            const response = await fetch(
                `${BASE_URL}/reservations`,
                {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                },
            );

            if (!response.ok) {
                const errorText = await response.text();
                console.error("Erreur serveur:", errorText);
                throw new Error("Erreur lors du chargement des réservations");
            }

            const result = await response.json();
            
            // DEBUG
            console.log("Données reçues:", result);
            
            // Essayer différentes structures possibles
            const reservations = result?.data?.reservations || 
                            result?.reservations || 
                            result?.data || 
                            [];
            
            console.log("Nombre de réservations trouvées:", reservations.length);
            
            if (reservations.length === 0) {
                tbody.innerHTML = `<tr><td colspan="9">Aucune réservation disponible</td></tr>`;
                document.getElementById("reservationsPagination").innerHTML = "";
                return;
            }

            // Pagination
            const totalPages = Math.ceil(reservations.length / itemsPerPage);
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedReservations = reservations.slice(startIndex, endIndex);

            tbody.innerHTML = "";

            paginatedReservations.forEach((reservation) => {
                const statusClass = getReservationStatusClass(reservation.statutPaiement);
                const statusText = getReservationStatusText(reservation.statutPaiement);
                
                // Récupérer les détails de l'item
                const itemDetails = reservation.itemDetails || reservation.itemId || {};
                const itemName = reservation.type === 'event' ? 
                    (itemDetails.nom || 'Événement') : 
                    (itemDetails.titre || 'Destination');

                const row = `
                    <tr>
                        <td>${reservation._id ? reservation._id.substring(0, 8) : 'N/A'}...</td>
                        <td>${reservation.client?.prenom || ''} ${reservation.client?.nom || ''}</td>
                        <td>${reservation.type === 'event' ? 'Événement' : 'Destination'}</td>
                        <td>${reservation.date ? new Date(reservation.date).toLocaleDateString("fr-FR") : 'N/A'}</td>
                        <td>${reservation.nombrePlaces || 1}</td>
                        <td>${reservation.montantTotal ? reservation.montantTotal.toLocaleString("fr-FR") + " FCFA" : '0 FCFA'}</td>
                        <td>${reservation.montantPaye ? reservation.montantPaye.toLocaleString("fr-FR") + " FCFA" : '0 FCFA'}</td>
                        <td>
                            <span class="status-badge ${statusClass}">
                                ${statusText}
                            </span>
                        </td>
                        <td>
                            <button class="action-btn edit-btn" onclick="viewReservation('${reservation._id}')">
                                Détails
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteItem('reservation', '${reservation._id}')">
                                Supprimer
                            </button>
                        </td>
                    </tr>
                `;

                tbody.insertAdjacentHTML("beforeend", row);
            });

            // Afficher la pagination
            renderPagination('reservations', totalPages, page);
        } catch (error) {
            console.error("Erreur détaillée loadReservations:", error);
            tbody.innerHTML = `<tr><td colspan="9">Erreur lors du chargement des réservations: ${error.message}</td></tr>`;
        }
    }

    function getReservationStatusClass(status) {
        switch (status) {
            case 'paye':
                return 'status-paid';
            case 'en_attente':
                return 'status-pending';
            case 'acompte':
                return 'status-approved';
            case 'annule':
                return 'status-cancelled';
            default:
                return 'status-pending';
        }
    }

    function getReservationStatusText(status) {
        switch (status) {
            case 'paye':
                return 'Payé';
            case 'en_attente':
                return 'En attente';
            case 'acompte':
                return 'Acompte';
            case 'annule':
                return 'Annulé';
            default:
                return status;
        }
    }

    async function viewReservation(id) {
        try {
            const token = localStorage.getItem("authToken");
            const response = await fetch(
                `${BASE_URL}/reservations/${id}`,
                {
                    headers: {
                        Authorization: `Bearer ${token}`,
                    },
                },
            );

            if (!response.ok) throw new Error("Erreur lors du chargement des données");

            const result = await response.json();
            const reservation = result.data?.reservation || result.data;

            document.getElementById("reservationDetailModalTitle").textContent =
                `Réservation #${reservation._id.substring(0, 8)}`;

            let detailsHtml = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div>
                <h4 style="color: var(--deep-brown); margin-bottom: 10px;">Informations Client</h4>
                <p><strong>Nom:</strong> ${reservation.client?.prenom || ''} ${reservation.client?.nom || ''}</p>
                <p><strong>Email:</strong> ${reservation.client?.email || 'Non spécifié'}</p>
                <p><strong>Téléphone:</strong> ${reservation.client?.telephone || 'Non spécifié'}</p>
            </div>
            <div>
                <h4 style="color: var(--deep-brown); margin-bottom: 10px;">Détails Réservation</h4>
                <p><strong>Type:</strong> ${reservation.type === 'event' ? 'Événement' : 'Destination'}</p>
                <p><strong>Date de création:</strong> ${new Date(reservation.createdAt).toLocaleDateString("fr-FR")}</p>
                <p><strong>Nombre de places:</strong> ${reservation.nombrePlaces || 1}</p>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div>
                <h4 style="color: var(--deep-brown); margin-bottom: 10px;">Informations Paiement</h4>
                <p><strong>Montant total:</strong> ${reservation.montantTotal ? reservation.montantTotal.toLocaleString("fr-FR") + " FCFA" : '0 FCFA'}</p>
                <p><strong>Montant payé:</strong> ${reservation.montantPaye ? reservation.montantPaye.toLocaleString("fr-FR") + " FCFA" : '0 FCFA'}</p>
                <p><strong>Plan de paiement:</strong> ${reservation.tranche === 'deux' ? '2 tranches' : '1 tranche'}</p>
            </div>
            <div>
                <h4 style="color: var(--deep-brown); margin-bottom: 10px;">Statut</h4>
                <p><strong>Statut paiement:</strong> <span class="status-badge ${getReservationStatusClass(reservation.statutPaiement)}">
                    ${getReservationStatusText(reservation.statutPaiement)}
                </span></p>
            </div>
        </div>
    `;

            if (reservation.message) {
                detailsHtml += `
            <div style="margin-bottom: 20px;">
                <h4 style="color: var(--deep-brown); margin-bottom: 10px;">Message du client</h4>
                <p style="background: var(--cream); padding: 15px; border-radius: 8px; border: 1px solid var(--stone);">
                    ${reservation.message}
                </p>
            </div>
        `;
            }

            // Ajouter les informations de l'élément réservé
            if (reservation.itemId) {
                try {
                    const itemResponse = await fetch(
                        `${BASE_URL}/${reservation.type === 'event' ? 'events' : 'destinations'}/${reservation.itemId}`,
                        {
                            headers: {
                                Authorization: `Bearer ${token}`,
                            },
                        },
                    );

                    if (itemResponse.ok) {
                        const itemResult = await itemResponse.json();
                        const item = reservation.type === 'event' ?
                            (itemResult.data?.event || itemResult.data) :
                            (itemResult.data?.destination || itemResult.data);

                        if (item) {
                            detailsHtml += `
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: var(--deep-brown); margin-bottom: 10px;">${reservation.type === 'event' ? 'Événement' : 'Destination'} réservé(e)</h4>
                            <p><strong>${reservation.type === 'event' ? 'Nom' : 'Titre'}:</strong> ${item.nom || item.titre}</p>
                            ${item.lieu || item.localisation ? `<p><strong>Lieu:</strong> ${item.lieu || item.localisation}</p>` : ''}
                            ${item.prix ? `<p><strong>Prix unitaire:</strong> ${item.prix.toLocaleString("fr-FR")} FCFA</p>` : ''}
                        </div>
                    `;
                        }
                    }
                } catch (itemError) {
                    console.error("Erreur chargement de l'item:", itemError);
                }
            }

            document.getElementById("reservationDetails").innerHTML = detailsHtml;

            // Configurer le bouton pour changer le statut
            const changeStatusBtn = document.getElementById("changeStatusBtn");
            changeStatusBtn.style.display = 'block';
            changeStatusBtn.onclick = () => changeReservationStatus(reservation._id, reservation.statutPaiement);

            document.getElementById("reservationDetailModal").classList.add("show");
        } catch (error) {
            console.error("Erreur viewReservation:", error);
            alert("Erreur lors du chargement des données");
        }
    }

    async function changeReservationStatus(id, currentStatus) {
        const newStatus = prompt(
            "Changer le statut de la réservation:\n" +
            "1. paye - Paiement complet\n" +
            "2. acompte - Acompte versé\n" +
            "3. en_attente - En attente de paiement\n" +
            "4. annule - Réservation annulée\n\n" +
            "Statut actuel: " + currentStatus,
            currentStatus
        );

        if (!newStatus || !['paye', 'acompte', 'en_attente', 'annule'].includes(newStatus)) {
            alert("Statut invalide");
            return;
        }

        try {
            const token = localStorage.getItem("authToken");
            const response = await fetch(
                `${BASE_URL}/reservations/${id}/status`,
                {
                    method: "PATCH",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${token}`,
                    },
                    body: JSON.stringify({ statutPaiement: newStatus }),
                },
            );

            if (!response.ok) throw new Error("Erreur lors du changement de statut");

            alert("Statut mis à jour avec succès!");
            closeModal('reservationDetailModal');
            await loadReservations(currentPage.reservations);
        } catch (error) {
            console.error("Erreur changeReservationStatus:", error);
            alert("Erreur lors du changement de statut");
        }
    }   

    function filterReservations() {
        const filter = document.getElementById("reservationStatusFilter").value;
        const rows = document.querySelectorAll("#reservationsTableBody tr");

        rows.forEach(row => {
            if (filter === 'all') {
                row.style.display = "";
            } else {
                const statusBadge = row.querySelector(".status-badge");
                if (statusBadge) {
                    const statusText = statusBadge.textContent.toLowerCase().trim();
                    const filterText = getReservationStatusText(filter).toLowerCase();
                    row.style.display = statusText === filterText ? "" : "none";
                }
            }
        });
    }

</script>
</body>

</html>